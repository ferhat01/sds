var product_count,product_profit,product_sku,amazon_commission,usd_value,file_name,next_page,this_page,asin_list,product_list,product_list_detail;function getAsin(){$.get(this_page,function(i,t){var e=$(i).find("li.s-result-item[data-asin]"),a=$(i).find("#pagnNextLink"),n=!1;e.each(function(i){var t=$(this).attr("data-asin");if(!(asin_list.length<product_count))return getData(),n=!0,!1;t&&asin_list.push(t),$("#find_product").text(asin_list.length)}),n||(a?(next_page=a.attr("href"),this_page=next_page,getAsin()):getData())})}function getData(){$.each(asin_list,function(i,t){var e=t;$.get("https://www.amazon.com/dp/"+e,function(t,a){var n=$(t).find("#ourprice_shippingmessage span.a-color-secondary").text(),o={title:$(t).find("#productTitle").text().trim(),asin:e,price:parseFloat($(t).find("#priceblock_ourprice").text().replace("$","")),shipping:parseFloat(n.length?n.split("$")[1].split(" ")[0]:0)},r=o.price+o.shipping,p=r/100*product_profit,s=r+p,c=s/100*amazon_commission,l=s+c,u={title:o.title,price:(l*usd_value).toFixed(2),sku:product_sku+(1e3+i),asin:o.asin},d={title:u.title,price:u.price,sku:u.sku,asin:u.asin,productPrice:o.price,shipping:o.shipping,p_price_shipping:r.toFixed(2),p_profit:p.toFixed(2),p_sell_price:s.toFixed(2),a_profit:c.toFixed(2),a_sell_price:l.toFixed(2)};$("#add_product").text(product_list.length),"NaN"!==u.price&&(product_list.push(u),product_list_detail.push(d)),asin_list.length===i+1&&($("#loading").fadeOut(),download(),setTimeout(function(){download_detail()},3e3))})})}function convertToCSV(i){for(var t="object"!=typeof i?JSON.parse(i):i,e="",a=0;a<t.length;a++){var n="";for(var o in t[a])""!==n&&(n+=","),n+=t[a][o];e+=n+"\r\n"}return e}function exportCSVFile(i,t,e){i&&t.unshift(i);var a=JSON.stringify(t),n=this.convertToCSV(a),o=e+".csv"||"export.csv",r=new Blob([n],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,o);else{var p=document.createElement("a");if(void 0!==p.download){var s=URL.createObjectURL(r);p.setAttribute("href",s),p.setAttribute("download",o),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p)}}}function download(){var i=[],t={title:"ProductName".replace(/,/g,""),price:"Price",sku:"Sku",asin:"ASIN"};$.each(product_list,function(t,e){i.push({title:e.title.replace(/,/g,""),price:e.price,sku:e.sku,asin:e.asin})}),exportCSVFile(t,i,file_name+"_amazon")}function download_detail(){var i=[],t={title:"ProductName".replace(/,/g,""),sku:"Sku",asin:"ASIN",productPrice:"Urun Ucreti - USD",shipping:"Kargo Ucreti - USD",p_price_shipping:"Urun Bana Gelisi - USD",p_profit:"Urunden Kazancagim - USD",a_profit:"Amazonun Komisyonu - USD",a_sell_price:"Urunun Son Fiyati - USD",price:"Magazamdaki Son Fiyati - 1 USD = "+usd_value};$.each(product_list_detail,function(t,e){i.push({title:e.title.replace(/,/g,""),sku:e.sku,asin:e.asin,productPrice:e.productPrice,shipping:e.shipping,p_price_shipping:e.p_price_shipping,p_profit:e.p_profit,a_profit:e.a_profit,a_sell_price:e.a_sell_price,price:e.price})}),exportCSVFile(t,i,file_name+"_detail")}$(document).delegate("#action_start","click",function(){product_count=$("#product_count").val(),product_profit=$("#product_profit").val(),product_sku=$("#product_sku").val(),amazon_commission=$("#amazon_commission").val(),usd_value=$("#usd_value").val(),file_name=$("#file_name").val(),next_page=null,this_page=location.href,asin_list=[],product_list=[],product_list_detail=[],$("#loading").fadeIn(),getAsin()});